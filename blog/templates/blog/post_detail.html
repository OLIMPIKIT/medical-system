{% extends 'blog/base.html' %}

{% block content %}

    <div class="post">
        {% if post.published_date %}
            <div class="date">
                {{ post.published_date }}
            </div>
        {% endif %}
        <h1>{{ post.title }}</h1>
        <p>{% autoescape off %} {{ post.text }}{% endautoescape %}</p>
    </div>
	
	{% with comments.count as total_comments %}
	<br>
    <h2>
        Комментарии к записи - {{ total_comments }}
    </h2>
    {% endwith %}
	
	{% for comment in comments %}
		<div class="col-xl-12">
		<div class="comment">
			<p class="info">
				<h4>Комментарий от {{ comment.author_id }}</h4>
				{{ comment.created }}
			</p>
			{{ comment.body|linebreaks }}
		</div>
		</div>
    {% empty %}
	<div class="col-xl-12">
    <p>В данный момент комментариев нет.</p>
	</div>
    {% endfor %}
	
	
	{% if request.user.is_authenticated %}
		{% if new_comment %}
			<div class="col-xl-12">
			<br>
			<h2>Ваш комментарий добавлен к посту.</h2>
			</div>
			
		{% else %}
			<br>
			<div class="col-xl-12">
			<h2>Написать новый комментарий</h2>
			<form action="." method="post">
				{{ comment_form.as_p }}
				{% csrf_token %}
				<p><input type="submit" value="Добавить комментарий"></p>
			</form>
			</div>
		{% endif %}
		{% else %} 	
		    <div class="col-xl-12">
			<h2>Чтобы добавить комментарий, войдите или зарегистрируйтесь.</h2>
			</div>
	{% endif %}
{% endblock %}